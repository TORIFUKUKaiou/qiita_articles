---
title: かっこいいフィボナッチ数列(Elixir)
tags:
  - Elixir
private: false
updated_at: '2020-09-10T00:57:15+09:00'
id: 33c3fd744bd1a4618cb3
organization_url_name: fukuokaex
slide: false
---
# はじめに
- Twitterでかっこいいと私が感じた[フィボナッチ数列](https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A3%E3%83%9C%E3%83%8A%E3%83%83%E3%83%81%E6%95%B0)のプログラムが書いてあったので写してみました
- [Fibonacci sequence generated by an @elixirlang stream](https://twitter.com/ramalhoorg/status/1299234312731136000)
- [Elixir](https://elixir-lang.org/)は、1.10.4-otp-23を使っています

# [フィボナッチ数列](https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A3%E3%83%9C%E3%83%8A%E3%83%83%E3%83%81%E6%95%B0)

```math
f(0) = 0 \\
f(1) = 1 \\
f(n) = f(n -1) + f(n - 2)
```

# プログラム

```elixir:lib/fibonacci.ex
defmodule Fibonacci do
  def sequence, do: Stream.unfold({0, 1}, fn {a, b} -> {a, {b, a + b}} end)

  def at(n), do: sequence() |> Enum.take(n + 1) |> Enum.at(-1)
end

defmodule PureFibonacci do
  def at(0), do: 0

  def at(1), do: 1

  def at(n), do: at(n - 1) + at(n - 2)
end
```
- Fibonacciモジュールの方が、[Twitter]((https://twitter.com/ramalhoorg/status/1299234312731136000))に書いてあった、私がかっこいいと感じたプログラムです
    - すこーし変えています(意味するところは同じはずです)
- `PureFibonacci`モジュールは素朴にフィボナッチ数列の計算を書いてみた例です



# 計測

```elixir
$ iex -S mix

iex> :timer.tc(Fibonacci, :at, [40])    
{19, 102334155}

iex> :timer.tc(PureFibonacci, :at, [40])
{6503506, 102334155}
```

- [:timer.tc/3](http://erlang.org/doc//man/timer.html)は、引数に(モジュール、メソッド名のアトム、引数)を指定してコールすると結果を`{時間, 値}`の形で得られます
    - 時間の単位は、microsecondsであります
- `PureFibonacci.at(40)`は約6.5秒かかるのに対して、`Fibonacci.at(40)`は19μ秒:rocket::rocket::rocket:で計算が終わっているのであります
    - `PureFibonacci`のほうが数式そのままで書いている内容はわかりやすいですが、時間はかかるという結果になりました
- [Stream.unfold/2](https://hexdocs.pm/elixir/Stream.html#unfold/2)


# Wrapping Up
- [Stream.unfold/2](https://hexdocs.pm/elixir/Stream.html#unfold/2) は、というかこれに限らず[Stream](https://hexdocs.pm/elixir/Stream.html#content)は全般的に個人的にはあまりうまく使えていない気がするので理解を深めていきたいとおもいます
- Enjoy [Elixir](https://elixir-lang.org/)! :rocket::rocket::rocket: :lgtm::lgtm::lgtm: 

