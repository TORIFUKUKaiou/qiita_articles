---
title: Bcrypt.Base.gensalt_nif/3 is undefined (Elixir)
tags:
  - Elixir
  - 40ä»£é§†ã‘å‡ºã—ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
  - autoracex
  - AdventCalendar2022
private: false
updated_at: '2022-01-29T22:57:05+09:00'
id: d6f2bf0f405d1e53abc0
organization_url_name: fukuokaex
slide: false
ignorePublish: false
---
https://qiita.com/official-events/5cb794f7cb9ac194ed70

**è¡¨ã¨è£ã€ä¸¡é¢ã®ã“ã“ã‚ãŒã‘ã€ã©ã‚Œã‚‚ãŠã‚ãã‹ã«ã—ã¦ã¯ãªã‚‰ã˜ã€‚**

Advent Calendar 2022 28æ—¥ç›®[^1]ã®è¨˜äº‹ã§ã™ã€‚
I'm ready for 12/25,2022 :santa::santa_tone1::santa_tone2::santa_tone3::santa_tone4::santa_tone5:
I'm looking forward to 12/25,2022 :santa::santa_tone1::santa_tone2::santa_tone3::santa_tone4::santa_tone5:
I can't wait for 12/25,2022 :santa::santa_tone1::santa_tone2::santa_tone3::santa_tone4::santa_tone5:
ç§ã®[Advent Calendar 2022 ä¸€è¦§](https://docs.google.com/spreadsheets/d/1HQvFjagQLRPjOYAjDVzWp9S4b8dKixxvvaz_TtbZWto/edit#gid=1723448955)ã€‚

[^1]: @kaizen_nagoya ã•ã‚“ã®ã€Œ[ã€Œ@e99h2121 ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã¯ã‚ã‚Šã¾ã™ã¾ã„ã‹ Advent Calendar 2020ã€ã®æ”¹è¨‚ç‰ˆã§ã¯ã‚ã‚Šã¾ã™ã¾ã„ã‹ Advent Calendar 2022 ï¼‘æ—¥ç›®ã€€Most Breakthrough Generator](https://qiita.com/kaizen_nagoya/items/49ebebee3a0377f3b59b)ã€ã‹ã‚‰ç€æƒ³ã‚’å¾—ã¦ã€æ¨¡å€£ã„ãŸã—ã¾ã—ãŸã€‚ 

---



# ã¯ã˜ã‚ã«

[Elixir](https://elixir-lang.org/)ã‚’æ¥½ã—ã‚“ã§ã„ã¾ã™ã‹:bangbang::bangbang::bangbang:

**Bcrypt.Base.gensalt_nif/3 is undefined**

```elixir
** (UndefinedFunctionError) function Bcrypt.Base.gensalt_nif/3 is undefined (module Bcrypt.Base is not available)
```

ã“ã®ã‚¨ãƒ©ãƒ¼ã§æ‚©ã‚“ã ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚
ä¸€å¿œè§£æ±ºã§ããŸã®ã§è¨˜äº‹ã‚’æ®‹ã—ã¦ãŠãã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2022-01-28 23.34.41.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131808/c1e166ef-4982-f2a5-3b0d-d783e0037ba7.png)


# Bcrypt.Base.gensalt_nif/3 is undefined

ã‘ã£ã“ã†æ‚©ã‚“ã§ã„ã‚‹folksãŒã„ã‚‹ã‚ˆã†ã§ã™ã€‚

https://elixirforum.com/t/function-bcrypt-base-gensalt-nif-3-is-undefined-module-bcrypt-base-is-not-available/15523

https://stackoverflow.com/questions/68855832/module-bcrypt-base-is-not-available

# ç§ã®å ´åˆ

ã‚‚ã¨ã‚‚ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§[Phoenix](https://www.phoenixframework.org/)ã‚¢ãƒ—ãƒªã‚’å‹•ã‹ã—ã¾ã—ãŸã€‚
ã‚ã¨ã‹ã‚‰Dockerã§å‹•ã‹ãã†ã¨ã—ã¦ã€å•é¡Œã«é­é‡ã—ã¾ã—ãŸã€‚
çµè«–ã‚’ã–ã£ãã‚ŠãŠä¼ãˆã™ã‚‹ã¨ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ä¸Šã§ä»¥å‰ãƒ“ãƒ«ãƒ‰ã—ãŸ`deps`ã‚„`_build`ã‚’è¦‹ã«è¡Œã£ã¦ã—ã¾ã£ã¦ã„ã¦ãŠã‹ã—ãªå…·åˆã«ãªã£ã¦ã„ã¾ã—ãŸã€‚

`Dockerfile`ã‚„`docker-compose.yml`ã®æ›¸ãæ–¹æ¬¡ç¬¬ã§è§£æ±ºã§ããŸã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ç§ã®å ´åˆã¯ã€ã¾ã‚ä¸€å›ã¾ã£ã•ã‚‰ã‹ã‚‰ã‚„ã£ã¦ã¿ã‚‹ã‹ã¨ã„ã†ã“ã¨ã§ã€Dockerã®ã‚³ãƒ³ãƒ†ãƒŠã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’æ¶ˆã—ã¦ã€ã•ã‚‰ã«`_build`ã€`deps`ã‚’æ¶ˆã—ã¦ã€å†åº¦ãƒ“ãƒ«ãƒ‰ã—ã¦å‹•ã‹ã—ã¦ã¿ã‚‹ã¨å‹•ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã ã„ãŸã„ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚

```
$ docker ps -a
```

ã§ã¦ããŸ`CONTAINER ID`ã¨`IMAGE`ã‚’ãƒ¡ãƒ¢

```
$ docker rm <ã‚³ãƒ³ãƒ†ãƒŠID>
$ docker rmi <Imageå>
$ docker image prune
$ docker volume prune
$ rm -rf _build
$ rm -rf deps
$ docker-compose build
$ docker-compose up
```



## Docker

ã‚ã¨ã‹ã‚‰ã€[Phoenix](https://www.phoenixframework.org/)ã‚¢ãƒ—ãƒªã«è¿½åŠ ã—ãŸDockeré–¢ä¿‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª¬æ˜ã—ã¾ã™ã€‚

### Configuration

ä½¿ç”¨ã™ã‚‹éš›ã«ã¯ã€`config`é…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å°‘ã—ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff:config/dev.exs
 config :realworld, Realworld.Repo,
   username: "postgres",
   password: "postgres",
-  hostname: "localhost",
+  hostname: "db",
   database: "realworld_dev",
   show_sensitive_data_on_connection_error: true,
   pool_size: 10

 config :realworld, RealworldWeb.Endpoint,
   # Binding to loopback ipv4 address prevents access from other machines.
   # Change to `ip: {0, 0, 0, 0}` to allow access from other machines.
-  http: [ip: {127, 0, 0, 1}, port: 4000],
+  http: [ip: {0, 0, 0, 0}, port: 4000],
   check_origin: false,
   code_reloader: true,
   debug_errors: true,
```

> Change to `ip: {0, 0, 0, 0}` to allow access from other machines.

ã“ã®`http: [ip: {0, 0, 0, 0}, port: 4000]`è¨­å®šã‚’çŸ¥ã‚‰ãšã«ã€ã‚ã‚Œã€œã€€http://localhost:4000 ã«ã¤ãªãŒã‚“ãªã„ãªã‚ã€œã€€ã¨ã‘ã£ã“ã†æ‚©ã‚“ã ã‚Šã—ã¾ã—ãŸã€‚


```diff:config/test.exs
 config :realworld, Realworld.Repo,
   username: "postgres",
   password: "postgres",
-  hostname: "localhost",
+  hostname: "db",
   database: "realworld_test#{System.get_env("MIX_TEST_PARTITION")}",
   pool: Ecto.Adapters.SQL.Sandbox,
   pool_size: 10
```

### Dockeré–¢ä¿‚ã®ãƒ•ã‚¡ã‚¤ãƒ«

ã‚ã¨ã‹ã‚‰ã€[Phoenix](https://www.phoenixframework.org/)ã‚¢ãƒ—ãƒªã«è¿½åŠ ã—ãŸDockeré–¢ä¿‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

```docker:Dockerfile
FROM hexpm/elixir:1.13.1-erlang-24.2.1-debian-bullseye-20210902-slim

RUN apt-get update && \
    apt-get install --yes build-essential inotify-tools postgresql-client && \
    apt-get clean

RUN mix local.hex --force && \
  mix archive.install hex phx_new --force && \
  mix local.rebar --force

ADD . /app
WORKDIR /app
EXPOSE 4000

CMD ["/app/entrypoint.sh"]
```

`Dockerfile`ã®å†…å®¹ã¯ã‚‚ã†ã¡ã‚‡ã£ã¨å³é¸ã§ãã‚‹ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
`bcrypt`ã®ãƒ“ãƒ«ãƒ‰ã«`make`ãŒå¿…è¦ã ã¨ã„ã†ãƒ­ã‚°ãŒã§ã¦ã„ãŸã®ã§ã€ã‚¨ã‚¤ã£ã¦ãªå…·åˆã§`build-essential`ã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚


```yml:docker-compose.yml
version: '3'
services:
  web:
    build: .
    ports:
      - '4000:4000'
    volumes:
      - .:/app
    depends_on:
      - db

  db:
    image: postgres:13-alpine
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - 5432:5432
    volumes:
      - db:/var/lib/postgresql/data
volumes:
  db:
```

```sh:entrypoint.sh
#!/bin/bash
# Docker entrypoint script.

# Wait until Postgres is ready
echo "Testing if Postgres is accepting connections."
while ! pg_isready -q -h db -p 5432 -U postgres
do
  echo "$(date) - waiting for database to start"
  sleep 2
done

mix setup
mix deps.compile

exec mix phx.server
```

```:.dockerignore
deps
_build
```

### Run

```
$ docker-compose build
$ docker-compose up
```

Visit: http://localhost:4000

### ãƒ†ã‚¹ãƒˆ

```
$ docker-compose run --rm web mix test
```







# Wrapping up :lgtm::lgtm::lgtm::lgtm::lgtm:

Enjoy [Elixir](https://elixir-lang.org/):bangbang::bangbang::bangbang:
<font color="purple">$\huge{Enjoy\ ElixirğŸš€}$</font>

æ‚©ã¿å¤šã„è¨˜äº‹ã§ã—ãŸã€‚
ä¸€å¿œå‹•ã„ãŸã‚ˆã€œã€€ãã‚‰ã„ã®ã‚‚ã®ã§ã—ã¦ã€ã¾ã ã¾ã æ‚©ã¿å¤šã„è¨˜äº‹ã§ã™ã€‚
ãŸã ã€ã‚ã‚Œã€œã€€ãªã‚“ã§Dockerã ã¨å‹•ã‹ã­ã€œã‚“ã ãƒ¼ã€€ã¨æ¬¡ã«ãªã£ãŸã¨ãã«ã¯ãƒ’ãƒ³ãƒˆã«ãªã‚Šãã†ã§ã™ã€‚
ã¨ã„ã†ã“ã¨ã‚’æ›¸ã„ã¦ãŠã‹ãªã„ã¨è¨˜æ†¶ã«å®šç€ã—ãªã„ã®ã§ã€å¤–åŒ–ã—ã¦ãŠãã¾ã™ã€‚
ãŠä»˜ãåˆã„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ :pray::pray_tone1::pray_tone2::pray_tone3::pray_tone4::pray_tone5: 


---
2022å¹´ã«æµè¡Œã‚‹æŠ€è¡“äºˆæƒ³ ãƒ¼ãƒ¼ ãã‚Œã¯ã€[Elixir](https://elixir-lang.org/)ã€[Phoenix LiveView](https://github.com/phoenixframework/phoenix_live_view)ã€[Livebook](https://github.com/livebook-dev/livebook)ã€[Nerves Livebook](https://github.com/livebook-dev/nerves_livebook)ã§ã™:rocket::rocket::rocket:

[Elixir](https://elixir-lang.org/)ã®èª•ç”Ÿæ—¥ã¯ã€2012å¹´5æœˆ24æ—¥ã§ã™ã€‚
ãã®ãŸã‚ã€ä»Šå¹´ã®2022å¹´5æœˆ24æ—¥ã¯10å‘¨å¹´ã‚’è¿ãˆã¾ã™ã€‚

```elixir
iex> Date.diff(~D[2022-05-24], ~D[2022-01-27])
117
```


ãã†ãã†ï¼
2æœˆ24æ—¥ç™ºå£²äºˆå®šã®[WEB+DB PRESS](https://gihyo.jp/magazine/wdpress)ã§ã€[Elixir](https://elixir-lang.org/)ã¨[Phoenix](https://www.phoenixframework.org/)ã®ç‰¹é›†ãŒã§ã¾ã™ã‚ˆã€œ

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">æ¬¡å·ã®WEB+DB PRESSã§Elixirã¨Phoenixç‰¹é›†ãŒå‡ºã¾ã™ï¼ãŠæ¥½ã—ã¿ã«ï¼ï¼1 <a href="https://t.co/d4hIfhIfZ1">pic.twitter.com/d4hIfhIfZ1</a></p>&mdash; æ —æ—å¥å¤ªéƒ (@kentaro) <a href="https://twitter.com/kentaro/status/1483308857019760640?ref_src=twsrc%5Etfw">January 18, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>






---

I organize [autoracex](https://autoracex.connpass.com/).
And I belong to [NervesJP](https://nerves-jp.connpass.com/), [fukuoka.ex](https://fukuokaex.connpass.com/), [EDI](https://fukuokaex.connpass.com/).
I hope someday you'll join us.

[We Are The Alchemists, my friends!](https://www.youtube.com/watch?v=04854XqcfCY)





