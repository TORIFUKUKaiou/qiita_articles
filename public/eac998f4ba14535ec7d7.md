---
title: Elixirã§ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã‚’ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«å¤‰æ›ã™ã‚‹
tags:
  - Elixir
private: false
updated_at: '2020-07-04T22:27:32+09:00'
id: eac998f4ba14535ec7d7
organization_url_name: fukuokaex
slide: false
---
# ã¯ã˜ã‚ã«
- @nejinejio ã•ã‚“ã®[Goè¨€èªã§ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã‚’ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«å¤‰æ›ã™ã‚‹](https://qiita.com/nejinejio/items/36d735e50b2d58a3d3da)ã‚’æ‹è¦‹ã—ã¾ã—ã¦ã€ç§ã¯ãœã²[Elixir](https://elixir-lang.org/)ã§ã‚„ã£ã¦ã¿ã‚ˆã†ã¨ãŠã‚‚ã„ã¾ã—ãŸ
- [Elixir](https://elixir-lang.org/)ã¯`Elixir 1.10.3 (compiled with Erlang/OTP 23)`ã‚’ä½¿ã„ã¾ã—ãŸ

## ãƒã‚¤ãƒ©ã‚¤ãƒˆ

```elixir:lib/awesome.ex
defmodule Awesome do
  def underscore(camel_cased_word) do
    case String.match?(camel_cased_word, ~r/[A-Z-]|::/) do
      false -> camel_cased_word
      _ -> do_underscore(camel_cased_word)
    end
  end

  defp do_underscore(camel_cased_word) do
    String.replace(camel_cased_word, "::", "/")
    |> (fn word ->
          Regex.replace(~r/(?:(?<=([A-Za-z\d]))|\b)((?-mix:(?=a)b))(?=\b|[^a-z])/, word, fn _,
                                                                                            g1,
                                                                                            g2 ->
            "#{g1 && "_"}#{String.downcase(g2)}"
          end)
        end).()
    |> String.replace(~r/([A-Z\d]+)([A-Z][a-z])/, "\\g{1}_\\g{2}")
    |> String.replace(~r/([a-z\d])([A-Z])/, "\\g{1}_\\g{2}")
    |> String.replace("-", "_")
    |> String.downcase()
  end
end
```
- [String.match?/2](https://hexdocs.pm/elixir/String.html#match?/2)
- [String.replace/4](https://hexdocs.pm/elixir/String.html#replace/4)
- [String.downcase/2](https://hexdocs.pm/elixir/String.html#downcase/2)
- [Regex.replace/4](https://hexdocs.pm/elixir/Regex.html#replace/4)



# 0. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
- ã¾ãšã¯[Elixir](https://elixir-lang.org/)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†
    - æ‰‹å‰å‘³å™Œã§ã™ãŒã€[ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](https://qiita.com/torifukukaiou/items/d04d0273749c41eb50af#0-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB) ãªã©ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ãã¾ã—ãŸã‚‰ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Šã¾ã™

```console
$ mix new camel_to_snake
$ cd camel_to_snake
```

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã ã€œãã®1ã€œ
- æ–‡å­—ã‚’1å€‹ãšã¤ç¢ºèªã—ã¦å¤§æ–‡å­—ã§ã‚ã‚Œã°å°æ–‡å­—ã«ã€å¿…è¦ã«å¿œã˜ã¦`_`ã‚’æŒ¿å…¥ã—ãŸã‚Šã—ã¾ã™
- æ³¨ç›®ã—ã¦ã„ã‚‹æ–‡å­—ã®1å€‹å‰ã¨2å€‹å‰ãŒå¤§æ–‡å­—ã§ã‚ã£ãŸã‹ã€å°æ–‡å­—ã§ã‚ã£ãŸã‹ã‚’æ°—ã«ã™ã‚‹ã“ã¨ã«ã—ã¾ã™

```elixir:lib/camel_to_snake.ex
defmodule CamelToSnake do
  @doc """
  convert camel to snake.

  ## Examples

      iex> CamelToSnake.convert("RememberMe")
      "remember_me"
      iex> CamelToSnake.convert("requestID")
      "request_id"
      iex> CamelToSnake.convert("HTTPRequest")
      "http_request"
      iex> CamelToSnake.convert("HTML5Script")
      "html5_script"

  """
  def convert(s) do
    s
    |> String.to_charlist()
    |> Enum.reduce({[], nil, nil}, &do_convert/2)
    |> elem(0)
    |> List.to_string()
  end

  defp do_convert(c, {list, :upcase, :upcase}) when ?a <= c and c <= ?z do
    {Enum.slice(list, 0..-2) ++ [?_, Enum.at(list, -1), c], :downcase, :upcase}
  end

  defp do_convert(c, {list, before_case, _}) when ?a <= c and c <= ?z do
    {list ++ [c], :downcase, before_case}
  end

  defp do_convert(c, {list, :downcase, _}) do
    {list ++ [?_, shift(c)], :upcase, :downcase}
  end

  defp do_convert(c, {list, before_case, _}) do
    {list ++ [shift(c)], :upcase, before_case}
  end

  defp shift(c) when ?A <= c and c <= ?Z, do: c + ?a - ?A

  defp shift(c), do: c
end
```

## ãƒ†ã‚¹ãƒˆ

```
$ mix test
```

- ã™ã¹ã¦ãƒ‘ã‚¹ã—ã¦ã„ã‚‹ã“ã¨ã§ã—ã‚‡ã†
    - `mix new`ã—ãŸã¨ãã«ã§ãã¦ã„ã‚‹`CamelToSnake.hello/1`ã¯ğŸ‘†ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã¯æ¶ˆã—ã¦ã„ã¾ã™
    - `test/camel_to_snake_test.exs`ã«ã¯ã€`CamelToSnake.hello/1`ã®ãƒ†ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã®ã§ã€`CamelToSnake.hello/1`ã‚’æ¶ˆã™å ´åˆã¯ãƒ†ã‚¹ãƒˆã®ã»ã†ã‚‚ã‚ã‚ã›ã¦æ¶ˆã™ã‹ã€æ°—ã«ã—ãªã„ã“ã¨ã«ã™ã‚‹ã‹ã—ã¦ãã ã•ã„

## å®Ÿè¡Œ

```elixir
$ iex -S mix

iex> CamelToSnake.convert("RememberMe")
"remember_me"
```

- ã†ã‚“ã€å‹•ã„ã¦ã„ã¾ã™ :tada::tada::tada:
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«æŒ™ã’ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æ­£ã—ã„å€¤ãŒè¿”ã£ã¦ã„ã¾ã™ãŒã€ã„ã‚ã„ã‚å¯¾å¿œã§ãã¦ã„ãªã„ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã§ã™:sweat:

```elixir
iex> CamelToSnake.convert "ActiveModel::Errors"
"active_model_::_errors"
```
- æ­£ã—ãã¯ã€`"active_model/errors"`
    - å¾Œè¿°ã™ã‚‹ActiveSupportã®`underscore`ãƒ¡ã‚½ãƒƒãƒ‰ã®çµæœã‚’æ­£ã¨ã—ã¦ã„ã¾ã™

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã ã€œãã®2ã€œ
- ãã†ã„ãˆã°[Ruby on Rails](https://rubyonrails.org/)ã§ã€ã“ã®ç”¨é€”ã«ã´ã£ãŸã‚Šã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã£ãŸã“ã¨ã‚’ãŠã‚‚ã„ã ã—ã¾ã—ãŸ
- `underscore`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰åã§å®Ÿè£…ã¯[ã“ã“](https://github.com/rails/rails/blob/v6.0.3.2/activesupport/lib/active_support/inflector/methods.rb#L80-L100)ã«ã‚ã‚Šã¾ã—ãŸ

```ruby:activesupport/lib/active_support/inflector/methods.rb
    # Makes an underscored, lowercase form from the expression in the string.
    #
    # Changes '::' to '/' to convert namespaces to paths.
    #
    #   underscore('ActiveModel')         # => "active_model"
    #   underscore('ActiveModel::Errors') # => "active_model/errors"
    #
    # As a rule of thumb you can think of +underscore+ as the inverse of
    # #camelize, though there are cases where that does not hold:
    #
    #   camelize(underscore('SSLError'))  # => "SslError"
    def underscore(camel_cased_word)
      return camel_cased_word unless /[A-Z-]|::/.match?(camel_cased_word)
      word = camel_cased_word.to_s.gsub("::", "/")
      word.gsub!(inflections.acronyms_underscore_regex) { "#{$1 && '_' }#{$2.downcase}" }
      word.gsub!(/([A-Z\d]+)([A-Z][a-z])/, '\1_\2')
      word.gsub!(/([a-z\d])([A-Z])/, '\1_\2')
      word.tr!("-", "_")
      word.downcase!
      word
    end
```

- ã“ã¡ã‚‰ã‚’å‚è€ƒã«[Elixir](https://elixir-lang.org/)ã§æ›¸ã„ã¦ã¿ã¾ã™

```lib/awesome.ex
defmodule Awesome do
  @doc """
  underscore

  ## Examples

      iex> Awesome.underscore("RememberMe")
      "remember_me"
      iex> Awesome.underscore("requestID")
      "request_id"
      iex> Awesome.underscore("HTTPRequest")
      "http_request"
      iex> Awesome.underscore("HTML5Script")
      "html5_script"
      iex> Awesome.underscore("ActiveModel::Errors")
      "active_model/errors"
      iex> Awesome.underscore("Product")
      "product"
      iex> Awesome.underscore("SpecialGuest")
      "special_guest"
      iex> Awesome.underscore("ApplicationController")
      "application_controller"
      iex> Awesome.underscore("Area51Controller")
      "area51_controller"
      iex> Awesome.underscore("HTMLTidy")
      "html_tidy"
      iex> Awesome.underscore("HTMLTidyGenerator")
      "html_tidy_generator"
      iex> Awesome.underscore("FreeBSD")
      "free_bsd"
      iex> Awesome.underscore("HTML")
      "html"
      iex> Awesome.underscore("ForceXMLController")
      "force_xml_controller"
      iex> Awesome.underscore("Admin::Product")
      "admin/product"
      iex> Awesome.underscore("Users::Commission::Department")
      "users/commission/department"
      iex> Awesome.underscore("UsersSection::CommissionDepartment")
      "users_section/commission_department"

  """
  def underscore(camel_cased_word) do
    case String.match?(camel_cased_word, ~r/[A-Z-]|::/) do
      false -> camel_cased_word
      _ -> do_underscore(camel_cased_word)
    end
  end

  defp do_underscore(camel_cased_word) do
    String.replace(camel_cased_word, "::", "/")
    |> (fn word ->
          Regex.replace(~r/(?:(?<=([A-Za-z\d]))|\b)((?-mix:(?=a)b))(?=\b|[^a-z])/, word, fn _,
                                                                                            g1,
                                                                                            g2 ->
            "#{g1 && "_"}#{String.downcase(g2)}"
          end)
        end).()
    |> String.replace(~r/([A-Z\d]+)([A-Z][a-z])/, "\\g{1}_\\g{2}")
    |> String.replace(~r/([a-z\d])([A-Z])/, "\\g{1}_\\g{2}")
    |> String.replace("-", "_")
    |> String.downcase()
  end
end
```

- `Awesome.underscore/1`ã‚’ä½œã£ã¦ã¿ã¾ã—ãŸ
- `Awesome`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã€doctestã®å¯¾è±¡ã¨ãªã‚‹ã‚ˆã†ã«è¨­å®šã‚’ã—ã¾ã™

```elixir:test/camel_to_snake_test.exs
defmodule CamelToSnakeTest do
  use ExUnit.Case
  doctest CamelToSnake
  doctest Awesome # add
```

## ãƒ†ã‚¹ãƒˆ

```
$ mix test
```

- ã™ã¹ã¦ãƒ‘ã‚¹ã—ã¦ã„ã‚‹ã“ã¨ã§ã—ã‚‡ã† :rocket::rocket::rocket:
    - æ­£ç›´ã«ç”³ã—ã¾ã™ã¨ç§ã¯ã€`(~r/(?:(?<=([A-Za-z\d]))|\b)((?-mix:(?=a)b))(?=\b|[^a-z])/`ã®éƒ¨åˆ†ã¯ã‚ˆãã‚ã‹ã£ã¦ã„ãªã„ã§ã™:sweat_smile:


# Wrapping Up
- ãŠå¥½ããªè¨€èªã§ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„
- **Enjoy!**



